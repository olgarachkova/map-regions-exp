import { useEffect, useState } from 'react';

import borderRegion from '../data/border_region1.json';

const regioApp = [];

regioApp.push(borderRegion.find((region) => region.name === 'Оренбургская область')); 
// regioApp.push(borderRegion.find((region) => region.name === 'Самарская область')); 
// regioApp.push(borderRegion.find((region) => region.name === 'Республика Татарстан'));
// regioApp.push(borderRegion.find((region) => region.name === 'Республика Башкортостан')); 
// regioApp.push(borderRegion.find((region) => region.name === 'Челябинская область')); 

const coords = regioApp.map((item) => {
  JSON.parse(item.coords);
})

function latlngToPx(
  point,
  pixelDims,
  latLngBounds,
) {
  let coefX = pixelDims.width / (latLngBounds.lngMax - latLngBounds.lngMin);
  const coefY = pixelDims.height / (latLngBounds.latMax - latLngBounds.latMin);
  const viewboxCurrentX = (point.lng - latLngBounds.lngMin) * coefX;
  const viewboxCurrentY = (point.lat - latLngBounds.latMin) * coefY;
  return [viewboxCurrentX, pixelDims.height - viewboxCurrentY];
}

export const AnimationShadow = () => {


  const [pointsArr, setPointsArr] = useState([]);
  const [pointsList, setpointsList] = useState((pointsArr.map((point, pos, arr) => {
    // if (pos === 0 || pos === pointsArr.length - 1) return 
    return (
      <>
        {/* <line key={pos} x1={+point.split(',')[0]} y1={+point.split(',')[1]} x2={+point.split(',')[0] + 10} y2={+point.split(',')[1] + 10} stroke="black" /> */}

        <polygon
          points={+point.split(',')[0] + "," + +point.split(',')[1] + " "
            + +pointsArr[pos + 1]?.split(',')[0] + "," + +pointsArr[pos + 1]?.split(',')[1] + " "
            + (+pointsArr[pos + 1]?.split(',')[0] + 15) + "," + (+pointsArr[pos + 1]?.split(',')[1] + 10) + " "
            + (+point.split(',')[0] + 15) + "," + (+point.split(',')[1] + 10)
          }

        />
      </>
    )
  })));

  useEffect(() => {
    let district = document.querySelector('.district');
    let svg = document.querySelector('.svg');
    let points = district.getAttribute("points").split(" ");

    setPointsArr(points);

  }, []);

  const onMouseEnterPolygon = () => {
    setpointsList(pointsArr.map((point, pos, arr) => {
      return (
        <>
          <polygon
            key={point}
            points={+point.split(',')[0] + "," + +point.split(',')[1] + " "
              + +pointsArr[pos + 1]?.split(',')[0] + "," + +pointsArr[pos + 1]?.split(',')[1] + " "
              + (+pointsArr[pos + 1]?.split(',')[0] + 15) + "," + (+pointsArr[pos + 1]?.split(',')[1] + 10) + " "
              + (+point.split(',')[0] + 15) + "," + (+point.split(',')[1] + 10)
            }

          />
        </>
      )
    }));
  }

  function getBoundsFromElementsSquareHier(elementsSquareHier) {
    let res = {
      latMin: Infinity,
      latMax: -Infinity,
      lngMin: Infinity,
      lngMax: -Infinity
    };

    function workLayer(arr) {
      arr.forEach(item => {
        let lat = item[1];
        let lng = item[0];

        if (lat < res.latMin) {
          res.latMin = lat
        }

        if (lat > res.latMax) {
          res.latMax = lat
        }

        if (lng < res.lngMin) {
          res.lngMin = lng
        }

        if (lng > res.lngMax) {
          res.lngMax = lng
        }
      });
    }

    if (elementsSquareHier.type === 'Polygon') {
      workLayer(JSON.parse(elementsSquareHier.coords)[0])
    } else {
      JSON.parse(elementsSquareHier.coords).forEach((partCoords) => {
        workLayer((partCoords[0]))
      });
    }

    return res;
  }

  const onMouseLeavePolygon = () => {
    setpointsList(null)
  }

  // let mapLatLngBounds = getBoundsFromElementsSquareHier(coords[0]);

  const width = 1500;
  const height = 800;
  let pixelDims = { width, height };

  let polygonPoints = [];


  regioApp.map((reg) => {
    let mapLatLngBounds = getBoundsFromElementsSquareHier(reg);
    if (reg.type === 'Polygon') {
      let geoPoints = JSON.parse(reg.coords)[0].map(item => {
        return latlngToPx({ lat: item[1], lng: item[0] }, pixelDims, mapLatLngBounds);
      }).join(' ');

      polygonPoints.push(geoPoints);
    } else {
      JSON.parse(reg.coords).forEach((crds) => {
        let geoPoints = crds[0].map(item => {
          return latlngToPx({ lat: item[1], lng: item[0] }, pixelDims, mapLatLngBounds);
        }).join(' ');

        polygonPoints.push(geoPoints);
      });
    }
  })




  return (
    <div className="app-wrapper"><svg xmlns="http://www.w3.org/2000/svg" width="1500" height="800" className="svg">
      <defs>
        <linearGradient id="MyGradient">
          <stop offset="20%" stopColor="#FFF9ED" />
          <stop offset="80%" stopColor="#DBDBDB" />
        </linearGradient>
      </defs>


      <g>
        {polygonPoints.map((points, i) =>
          <g>
            <polygon
              key={i}
              points={points}
              className="region"
            >
              {/* <title>{geoInfo}</title> */}
            </polygon>
          </g>
        )}

      </g>
      <g className='pointsList'>{pointsList}</g>



      <g onMouseEnter={() => onMouseEnterPolygon()} onMouseLeave={() => onMouseLeavePolygon()}>
        <polygon points="432.08804307316126,544.0020025187033 434.45299390683886,546.4900410582999 435.6416085214594,546.9658252810183 437.5584665882603,549.7438032285597 439.21404479246604,549.3971037426074 440.26559185931967,550.8792734999402 439.4695150786392,551.4364358825708 439.30311123006743,552.1180735710141 442.3693452357406,555.3898600632056 442.4768704693548,556.9604564824889 442.0298764403351,558.8835606841284 442.2209744222617,559.4106480800501 443.0962702024927,560.5237533097669 445.8987933880591,563.2245077862831 446.4917684757163,563.3282716579504 447.220451423041,563.2040857334522 449.0858198869789,562.372796564754 450.22596642784475,562.5190994897869 452.98095546683584,561.9047842973634 454.12023675163823,562.2337695127956 456.8593764970301,561.0733297679146 458.05157574391177,561.1578704522012 458.60343056723855,561.8132984615066 458.5981978281909,562.6046116684905 457.7229707190758,563.8865708957487 457.5686529869412,564.5123373202249 458.15720565472054,565.0903351575646 459.13506861398184,565.0564155333802 460.0600548138341,563.8587489492811 460.03754442197186,563.2105554728616 459.72417065068976,562.5836521932177 459.79796463206816,561.8209463962708 460.16799207414493,561.2206868677399 460.77047124427236,560.6524453147476 462.5057491458412,560.3973556852159 464.9472408055417,560.2616978585708 465.7668580448265,559.9789103031351 466.46844336973254,560.3962188300482 467.19980449058585,560.4550872576389 467.9689896621955,560.043008264498 470.326990978923,558.9834799183186 471.1718379862687,558.9481753978389 472.1679949308633,559.4190608082909 473.02544995512784,559.6309706115455 473.99639086588485,559.4896905193443 474.63948213408327,558.9246321608221 474.56382029834714,558.359594472394 474.3746725761186,557.8416639280953 473.63070343834653,557.4061657184998 473.6878240727314,556.8803598684037 473.7499164959226,556.5100551351505 473.7706277045431,556.1945054807924 473.73957462583576,555.972322640841 473.7706277045431,555.9175882320402 474.00866926144636,555.6149367163111 473.9707216026805,555.505467898711 474.18463212937985,555.2833057288539 474.6296896329249,555.3380401376531 475.99245419801383,555.901486228847 476.57896046653246,556.4553207263498 476.97255583566033,557.1077515720316 476.53049239277874,558.0269506503312 476.5063476283524,558.9448475127125 476.6546909733845,559.5342759120108 477.1791048187129,560.1366231200323 477.67160032926967,560.4695356533152 478.37183970029974,560.5378089736579 478.63431444031653,560.511785325365 478.85704233832473,560.3631673498097 479.18332627943613,559.9627876298476 479.17394580497444,559.376873146522 478.7061306935501,558.1511779150178 478.585393137195,557.5736141496503 478.6825627664991,557.0745347310426 478.9021180589437,556.7610934262663 479.2428641371082,556.7155985494653 479.9288748528788,556.7332301396117 480.3332103845667,557.0225287746438 481.22180089287787,557.2993633430206 482.02212154853515,557.3991792267412 482.65233011535,557.1912380815272 483.0084447893012,556.8460268423397 483.09760736646626,556.1469849347834 482.70528928009844,555.8807127844191 482.54479114751337,555.481304558874 482.7399956621828,554.0646176592008 483.1891871669176,553.6971447288206 484.1140634929847,553.5177696534552 484.9343674434299,553.5510485047269 486.46798574541407,554.2998019882508 488.78622648591056,555.6310800596927 490.12367887759916,556.6130128731543 490.81915247317073,557.4452321960797 491.19364353779554,558.0944178370105 491.04655000707567,558.91047314646 490.66431284055335,560.36056291797 490.6106669646445,561.7994288284619 491.0884531221292,562.8096176603635 491.90695788933357,563.1063575292206 492.6024314849042,563.0064176249348 493.6010605896795,562.4568204966929 494.00878847450315,561.7867167206778 494.9028452036576,560.2587213650413 495.7766439535573,559.7425684488232 496.70393750291163,559.3596342881611 497.31024852131816,559.7425684488232 497.845237718528,560.2254218436755 498.32671838205994,560.3086603120422 498.79037202384876,560.1921223223096 499.21835788792714,559.775867970189 499.61067597429496,558.1942957310137 499.8959907275313,557.744865878091 500.841125032852,556.7794484697008 500.75196245568793,555.8141344117817 500.93028761001614,555.0486174820574 501.39394125180496,554.4661962446104 501.60793418384463,553.734082186723 502.1102084613363,553.4239894371688 502.5827756139967,553.3657617824894 503.1355918329496,553.7318084763874 503.634913252449,554.963146643542 504.57112031267485,555.5040003220404 507.7732132544698,555.7619630946322 508.0620714372981,555.6994153903165 508.4530435697909,555.671097361594 508.93121428552547,555.4041430981299 509.37702717134783,554.771782913682 509.4305357050248,553.9231515361532 508.96688206323597,553.4572682884403 507.69183798187345,553.016375184322 506.39005336789535,552.4257685896691 505.8104966163268,551.8601521386092 505.6767527505807,551.4359604704086 505.87290492665295,551.0284082278446 506.24739599127673,550.6624648844174 507.15686251888695,550.446235031525 508.3159897562474,550.9618711953956 509.7426047251001,550.9951500466672 510.6074899641283,550.6791043100526 511.7309494237782,549.6728427960034 512.4531635519644,548.6583752546526 512.7741598171347,548.1761419626189 513.6390450561628,547.8518901987042 515.003237980467,548.1844513403901 515.9751265526268,548.2260188993387 517.7405648083937,547.2366655221463 518.4984467142904,547.0537558607153 519.1939203098619,547.037137105173 520.1479681260543,547.2366655221463 520.7542791444607,546.9706207428167 521.3160088742862,547.0121883017653 521.9044928709496,546.4718307055233 523.0546928632142,546.1143827707122 523.3756891283844,546.9540019872743 523.3311078398024,547.5109990091529 523.6610038816207,547.9183858909663 524.3208234337052,548.1179349780338 524.9984562733093,547.793683214119 525.0341240510198,546.4552119499809 525.1589544058944,545.6738410581909 524.9895427624377,544.9091509322258 525.6493485802988,544.0364802354238 526.3359086649979,543.7539200510229 527.4630763649185,543.9361475993541 528.3688346522581,544.4520318043506 529.1713115809603,544.6514982110427 530.4347639779236,544.589797980579 531.2100471446444,544.8116707691203 531.8685756797454,544.9603714250524 532.8180912022738,544.8758927510469 533.4658795748147,544.5977559667517 534.1020487945087,543.828704450962 534.4212870791064,543.3582531124839 536.0101444268934,540.8373904636821 536.5508745294103,540.4549523852766 537.6141506228969,540.1978370865368 537.8837122220966,540.1052970758875 536.2330508698046,537.8055217520579 534.8813972913032,536.0105101226748 537.8846598834983,534.2475991492086 541.053928031791,532.3729869879951 540.5134314110697,532.310542634149 540.3012376622728,532.1075209712958 539.9947447368259,532.1075209712958 539.333812712661,531.671278638318 538.7305232233628,531.1550223716303 538.0519839250251,530.9416449917051 537.3464019411623,530.9835639422506 536.5653641349111,530.5628448498358 536.0422550407895,530.4108576489641 536.0368712252856,529.9871413929257 536.0980159870751,529.635894486301 535.7244863180764,529.452323381863 535.3737829280749,529.1917768475258 535.0437083413544,529.049173869312 534.8071912832293,528.5337237362878 534.4171393436933,527.9562013111088 534.0446672098825,527.8590105293206 533.8560551223601,527.5135099088172 533.4847229290765,527.2886812968393 533.3787221942412,526.9310473311818 532.9972129415494,526.8751967373089 532.9072537794389,526.4426543511488 532.6993176398411,525.8852025872037 532.2073989666586,525.630485019363 532.1720333418597,525.2795895043369 532.015628007795,525.2150574710001 531.4528407427817,524.8109364640335 531.3079034851087,524.1711970560416 531.844856676239,523.6858839200075 531.7240916514381,523.2018729998948 531.8478644711249,522.5660402396611 531.6828340448759,522.4728594560991 531.5938225441671,522.2382745597736 531.1685697905099,521.4918154566778 531.3379814339675,520.3063235579211 530.803005970981,519.1292857275921 529.5636296673281,518.3087450077526 531.302313656257,516.4524672198795 531.7024465156384,516.107814073228 532.3990325832913,516.0667839367227 533.9376501425286,516.4141241955879 535.640487808844,516.8675640467383 535.6654016897711,516.7199175655985 535.7114113375684,516.2380149950677 536.0193600906764,516.212322068279 536.4846206365826,516.0743698612043 537.0539865945186,515.7164671843267 537.2039917805616,512.1088123354155 533.8297678191103,510.8684826773885 530.1837161116283,509.5553529484435 523.9443271724908,507.4282762596293 524.3209745101605,503.87523179895516 516.4407991252286,503.01841506422045 516.5866153731884,501.847247540575 516.8457664311853,499.3881678026138 514.9200909930747,499.1145991090823 514.9760442184856,498.1141045512472 515.1352788025341,495.6169711703087 514.533980775603,489.4526117296744 520.0968905498879,490.06225548086314 520.3323088701542,487.5311404654576 520.9216031859885,483.1539793586887 520.948233844818,481.000010877637 521.1426143060942,478.6132764685274 520.569306626092,478.5892991595367 520.8685616159007,475.25849954909506 524.5562829566417,472.08615687893445 523.3361345655022,471.33843690010724 522.3078944754583,470.29602339172504 524.8832948115836,467.6657952757928 528.693401815466,470.23992475672475 532.0039539180556,470.11096404052233 531.9754966075366,469.1316356588991 530.7091462894743,465.71970592967403 529.9670724745068,465.37261371193637 527.8652830920064,463.7320903647935 522.2884056127043,456.5970839819983 521.3885530413504,455.5362947600874 523.5144322513846,454.0762213331952 523.1522745192138,454.09377024296623 523.0554619797149,454.1618575324626 522.9955395637919,454.27674191467975 522.8710662987214,454.36611940095315 522.7373773698679,454.27674191467975 522.6728402549427,454.2895160327451 522.5944727772312,454.39590500634625 522.483829874946,454.44270209906557 522.340911548086,454.4086584543174 522.2118373182357,454.3022694807177 521.9582898233137,454.2809999540349 521.9075830711748,454.038436401441 521.819986195457,453.88525033512053 521.2299090289006,453.51930699169344 521.3261309968009,453.49557772383025 521.4597924572087,453.5587662010587 521.5575801265571,453.4865448927694 521.7303429204803,453.5858440241425 522.1052185433549,453.4504342386263 522.1541123780287,453.3481379436296 522.2421212804422,453.30903012586134 522.2616925485355,453.1616110157549 522.3692589848189,453.0773597127827 522.2747263263743,452.83667713873893 522.317096405018,452.7734886615105 522.4279315864276,452.8156143129966 522.5224642448723,452.791533653535 522.5452905238693,452.6621802055487 522.4996517000994,452.57191390523496 522.5289880009033,452.5147610954422 522.6430781932179,452.4846654386391 522.6658907379916,452.4064498031026 522.7702021633711,452.3312313311912 522.7962834532711,452.13569224235135 522.8745135887507,452.0574766068148 522.9005948786507,451.6964940859368 523.0212088269963,451.37461938282854 523.1516015422759,451.35355655708474 523.1825172787513,451.24681619188664 519.5144908141122,446.8279841756996 521.2998711619988,445.60456265453075 518.5760588097236,444.39294375701024 524.3139975247635,440.2974540206034 523.7339875438282,439.53983306677077 524.0793757894428,439.3475805228705 524.4174024914096,439.1590485958819 527.2183462413054,437.1879897762612 527.431913412425,437.91766476306253 527.5186312978552,438.23912606429417 528.0945759487158,439.1196307267051 528.3272611585619,439.27118385560294 528.4679820097059,439.70029500616425 528.4913439234082,440.9003799912567 530.6134324878325,439.4824322158506 531.0957921416511,438.9840969206237 532.2946662210182,438.1672561476019 534.7426129656338,441.1279990659193 537.9322489669663,438.94075173359454 533.407879950144,433.13508043340704 532.1022634878858,431.4158660385685 531.8887649878831,431.41638279091757 526.0756726033673,424.01394673249604 523.8920684531262,425.60207139145615 522.870201042658,424.1375745644567 521.6075314964197,423.5259464842484 520.9020868547877,422.0433013147549 520.8683556025519,421.1206503307637 521.6374446345989,419.23154843368695 519.6562829346674,418.5551816192014 519.8339763147277,418.0155888164359 519.8339763147277,417.1344847212991 519.5961957080658,416.65471117044723 516.6381461787215,415.7341065257582 514.6862795769248,415.1070378853622 514.887609555152,414.4343090074146 515.5049903574769,413.36270932636523 511.5980021429786,412.2724238803771 503.82807136785874,409.97971772867993 502.6338806586098,412.9790723825092 502.079649814665,414.8857645295453 501.48699061414175,415.0596206898242 501.46177458030417,415.66231928944273 500.90695316476064,416.57804579195806 501.03304706817187,417.67936906811934 500.7426506523422,418.78879502111124 495.0700731056216,416.978611542765 485.7662356098304,414.261341661176 482.8069362661719,413.2749027672319 481.87906587944326,412.82962760319475 481.8069749417449,413.08451053178743 476.0800785421765,411.32523749485773 474.9250715717843,414.36628372819933 471.273553643459,413.2918935844654 469.0718340527867,419.8293068808491 469.63367365639726,420.03873627282934 470.0607805301898,420.6449694585148 469.99774044559484,420.96969663459174 470.9434515882919,421.4800205843132 470.90562753753454,421.9323649204843 471.14877822547703,422.2749717278336 471.4352329192405,421.82798094599696 471.80090661255645,421.66559668786505 472.1413642720338,421.70038445599704 472.3557280281,421.8743646368382 472.1665940400938,422.2571334367481 472.21702610776896,422.5355182621708 472.5014069338269,422.5720629882877 472.43008511262923,422.30959413521197 472.6205375860636,422.1643453849715 473.18796701852597,422.48913457132954 473.3796693062746,422.375221683528 473.5880312067923,422.44349500387074 474.05579138132407,423.1849312741333 473.825482192096,423.47026125112615 474.26238156704585,423.68764862927907 474.48975163250503,423.97066355574947 474.7712208032388,423.7279966526846 475.060394873201,423.6302271082647 475.82166913223443,423.81629929407285 474.7406072196749,426.1579522282612 474.1476596004635,431.3147686090207 473.6965590387009,432.38093205536023 472.87375545962817,431.88024036942255 467.2099403473239,439.552896566152 473.7175724002319,443.6736658274693 471.4759411568742,446.61700452667355 472.0520643526369,447.05093180912746 466.22137842817165,454.2688872789751 466.2117507376929,454.4782753307669 466.47489845464673,454.8391751712696 467.1008768807092,455.2397409220765 467.0162053945389,455.9983127002306 465.43737402970476,458.38647334582384 467.63270720657795,459.0946927750974 468.55745992463557,459.1363636845156 469.02358572660415,459.53215464361836 469.22306158469615,459.5002193484535 471.04224185593563,456.95345707192274 474.2306417771772,457.302636969151 475.7828424831828,457.4940833793864 477.6778081981669,457.96286044025345 475.4023770314564,461.5679728676075 475.1317166943987,461.4846310487698 474.2257661279336,462.5003801359463 472.24893070831627,461.6225625857504 471.4519886715733,460.6363303927453 470.5527678744872,460.409042039587 466.15083945769805,466.2201082342959 458.03672904860684,460.9007215645581 457.0725453756765,462.12075319031936 456.31474587511815,461.97081232875 453.70102705619956,464.7552806857951 453.7646851808389,473.9052905079647 453.81050254951083,477.56369043754177 453.70516105739017,479.4408243502181 455.80184130885146,481.8040155223109 454.82793380587873,482.9782628899554 454.33107081233675,485.6503686162448 452.74397144512136,488.4932919990025 452.956618423285,489.1237918749945 453.344225671087,489.3137500384666 452.5426964037866,492.60775688166245 449.78872369731414,492.6006463693401 449.8740818946459,498.338561101534 451.4110101444265,498.32496017970954 450.7612028410726,500.21807207501536 447.831775432925,502.33477237666193 447.06268640087706,501.9614291395982 447.1057294564587,502.93827710994543 446.0689329453473,503.8998085406717 445.5202919302542,505.27620942722194 443.9328354732347,504.7192124053434 443.9351702911826,509.0998047477083 444.5650904393103,509.3728980290776 443.7561996283632,510.16297103042416 443.79811647764006,512.869451122966 443.18157346293185,512.866061227557 443.17989788769853,514.1433283434862 443.5830385419658,514.0437605008931 449.9263406140096,513.9718905842008 449.9239645933925,518.7045773070423 449.30571853500425,518.5505644369641 448.20514029124496,518.6896741692995 448.2058407366288,519.6493246214741 448.20901334219326,523.9843807468511 447.49819861928177,523.6912581444376 446.913422862889,523.8296857636717 445.95649085981927,523.1276053523034 445.173035830281,523.0604482170356 445.0827195783663,525.2183440159397 443.2395868218259,524.8198452745291 443.36335964151266,528.5391599709991 441.89459434158755,528.6056970034497 441.44688613296165,529.7793449383682 440.850669768623,531.1494207761684 440.53659555195713,532.2228187553925 441.4729124859691,532.8099734443553 442.8949814269355,532.8026355609998 443.15016329442045,533.1391860308206 444.33972557044274,533.4328873958657 442.2078994417537,535.1533006561547 442.4914562144174,535.361985924751 436.38586607791865,539.7466089354391 436.3241307445315,540.1600108145926 436.54740801146914,540.2194373347223 436.7667435563416,540.4822575793935 432.08804307316126,544.0020025187033" className="district"></polygon>
      </g>
    </svg></div>
  );
}